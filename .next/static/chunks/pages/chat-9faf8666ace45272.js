(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{813:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return s(4565)}])},7474:function(e,a,s){"use strict";function t(e){let a={};return e.forEach(e=>{a[e.name]=e.value||""}),a}function i(e){let a=new Date(e),s=a.getFullYear(),t=a.getMonth()+1>9?a.getMonth()+1:"0"+(a.getMonth()+1),i=a.getDate()>9?a.getDate():"0"+a.getDate();return"".concat(s,"-").concat(t,"-").concat(i)}s.d(a,{J:function(){return i},e:function(){return t}})},4565:function(e,a,s){"use strict";s.r(a),s.d(a,{__N_SSP:function(){return M},default:function(){return R}});var t,i,n=s(5893),l=s(682),o=s(4051),r=s(1555),c=s(7294),d=s(2175),u=s(7474),m=s(5949),h=s(3048),x=s(4597),f=s(6968),b=s(4699);function g(e){return(0,b.Z)().post("user/chat/start",e)}function v(e){return(0,b.Z)().post("user/chat/message",e)}function p(){return(0,b.Z)().get("user/chat/rooms")}function j(e){let{...a}=e,[s,t]=(0,c.useState)(!1),{currentConversationData:i}=a,l=null==i?void 0:i.chat_id,{data:o,isLoading:r}=(0,x.ib)({queryFn:()=>(0,b.Z)().get("user/chat/message/".concat(l)),queryKey:["get-chat-messages",l],options:{enabled:!!l}}),{mutate:h,isLoading:g}=(0,x.uV)({queryFn:v,alert:!1});if(Object.keys(i).length&&(null==o?void 0:o.data)){var p;return(0,n.jsxs)("div",{className:"box chat-box chat-height d-flex flex-column",children:[(0,n.jsxs)("div",{className:"d-flex align-items-center justify-content-between chat-box-header",children:[(0,n.jsxs)("div",{className:"chat-box-header-info d-flex align-items-center gap-3",children:[(0,n.jsx)("img",{src:(null===(p=i.user)||void 0===p?void 0:p.avatar)||"/images/user-placeholder.png",alt:"avatar",className:"img-fluid d-none d-md-block"}),(0,n.jsxs)("span",{className:"chat-box-header-info-name d-flex flex-column gap-1",children:[i.user.first_name," ",i.user.middle_name," ",i.user.last_name,(0,n.jsx)("span",{})]})]}),(0,n.jsx)("button",{type:"button",className:"bg-transparent p-0 border-0",children:(0,n.jsx)("i",{className:"las la-ellipsis-h"})})]}),(0,n.jsxs)("div",{className:"chat-box-body flex-fill d-flex flex-column",children:[(0,n.jsx)("div",{className:"flex-fill chat-box-body-list",children:o.data.map((e,s)=>{var t,l,o,r,c,d,m;return(0,n.jsxs)("div",{className:"chat-box-body-list-item d-flex gap-2 ".concat(e.from===(null===(t=a.user)||void 0===t?void 0:t.data.id)?"sender":"receiver"),children:[e.from!==(null===(l=a.user)||void 0===l?void 0:l.data.id)&&(0,n.jsx)("img",{src:(null==i?void 0:null===(o=i.member_b_id)||void 0===o?void 0:o.avatar)||"/images/user-placeholder.png",alt:"",className:"img-fluid chat-box-body-list-item-avatar d-none d-md-block"}),(0,n.jsxs)("div",{className:"chat-box-body-list-item-info",children:[(0,n.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[e.from!==(null===(r=a.user)||void 0===r?void 0:r.data.id)&&(0,n.jsxs)("span",{className:"chat-box-body-list-item-info-name",children:[null===(c=i.user)||void 0===c?void 0:c.first_name," ",null===(d=i.user)||void 0===d?void 0:d.middle_name]}),(0,n.jsx)("span",{className:"chat-box-body-list-item-info-date",children:(0,u.J)(e.updated_at)})]}),(0,n.jsxs)("div",{className:"chat-box-body-list-item-info-message",children:[e.file&&(0,n.jsx)("img",{src:e.file,alt:"",className:"img-fluid"}),e.message&&(0,n.jsx)("span",{children:e.message})]}),e.from===(null===(m=a.user)||void 0===m?void 0:m.data.id)&&(0,n.jsx)("i",{className:"las la-check-double"})]})]},s)})}),(0,n.jsx)(d.J9,{initialValues:{message:"",file:""},onSubmit:function(e,a){h({chat_id:i.chat_id,msg:e.message},{onSettled:()=>{a.resetForm()}})},children:e=>{let{setFieldValue:a,values:i}=e;return(0,n.jsx)(d.l0,{children:(0,n.jsxs)("div",{className:"chat-box-body-form d-flex align-items-center gap-3 position-relative",children:[(0,n.jsxs)("div",{className:"d-flex align-items-center flex-fill chat-box-body-form-input h-100 position-relative",children:[(0,n.jsx)("div",{className:"emoji-box ".concat(s?"active":""),children:(0,n.jsx)(y,{setFieldValue:a,setEmojiIsShow:t,values:i})}),(0,n.jsx)("button",{type:"button",className:"chat-box-body-form-emoji bg-transparent border-0 p-0 h-100",onClick:()=>t(e=>!e),children:(0,n.jsx)("i",{className:"las la-smile"})}),(0,n.jsx)(m.Wu,{type:"text",name:"message",placeholder:"إكتب رسالتك .....",id:"message-text",autoComplete:"off",noBorder:!0,containerStyle:{marginBottom:0,flex:1}})]}),(0,n.jsx)("button",{type:"button",className:"chat-box-body-form-camera chat-box-body-form-btn border-0 p-0 d-none d-md-block",children:(0,n.jsx)("i",{className:"las la-camera"})}),(0,n.jsx)("div",{className:"d-none d-lg-block",children:(0,n.jsx)(m.CF,{item:{name:"file",id:"chat-file-uploading"},children:(0,n.jsx)(N,{name:"file"})})}),(0,n.jsx)("button",{type:"submit",className:"chat-box-body-form-btn chat-box-body-form-submit p-0 border-0",disabled:g,children:g?(0,n.jsx)(f.Z,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}):(0,n.jsx)("i",{className:"las la-paper-plane"})})]})})}})]})]})}return(0,n.jsx)("div",{className:"box chat-box chat-height d-flex flex-column",children:(0,n.jsx)("img",{src:"/images/chat.jpg",alt:"",className:"img-fluid chat-empty-img"})})}function N(e){let{files:a,deleteFile:s,isLoading:t}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"cursor-pointer chat-box-body-form-file chat-box-body-form-btn",children:(0,n.jsx)("i",{className:"las la-paperclip"})}),t||a?(0,n.jsx)("div",{className:"position-absolute chat-uploading-img",children:(0,n.jsxs)("div",{className:"position-relative",children:[(0,n.jsx)("img",{src:a?"string"==typeof a?a:window.URL.createObjectURL(a):"/images/placholder.png",alt:"placholder",className:"img-fluid subscription-upload-img-img"}),t&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"position-absolute overlay-when-uploading-image d-flex align-items-center justify-content-center",children:(0,n.jsx)(f.Z,{as:"span",animation:"border",size:"md",role:"status","aria-hidden":"true"})})})]})}):null]})}let y=c.memo(e=>{let{setFieldValue:a,setEmojiIsShow:s,values:t}=e;return(0,n.jsx)(h.ZP,{onEmojiClick:e=>{a("message",t.message+e.emoji),s(e=>!e)}})});var _=s(1664),w=s.n(_);function Z(e){let{...a}=e,{data:s,isLoading:t}=(0,x.ib)({queryFn:p,queryKey:"get-rooms-list"});return t?(0,n.jsx)(f.Z,{as:"span",animation:"border",role:"status","aria-hidden":"true"}):(0,n.jsx)("div",{className:"box chat-conversations-list",children:s.data.map((e,a)=>{var s,t,i,l;return(0,n.jsxs)(w(),{href:{pathname:"/chat",query:{id:e.user.id}},className:"bg-transparent border-0 p-0 d-flex justify-content-between flex-wrap gap-2 chat-conversations-list-item w-100",children:[(0,n.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,n.jsx)("img",{src:(null===(s=e.user)||void 0===s?void 0:s.avatar)||"/images/user-placeholder.png",alt:"",className:"img-fluid chat-conversations-list-item-img"}),(0,n.jsx)("div",{className:"flex-fill chat-conversations-list-item-info text-end",children:(0,n.jsxs)("span",{className:"chat-box-header-info-name d-flex flex-column gap-1",children:[null===(t=e.user)||void 0===t?void 0:t.first_name," ",null===(i=e.user)||void 0===i?void 0:i.middle_name," ",null===(l=e.user)||void 0===l?void 0:l.last_name,(0,n.jsx)("span",{children:null==e?void 0:e.message})]})})]}),(0,n.jsx)("span",{className:"me-auto",children:(0,u.J)(e.updated_at)})]},a)})})}var k=s(1649),E=s(3970),F=s(3663),S=s(6606),C=s.n(S),P=s(1083);let q=new(C())("e28c3262971fb390a366",{cluster:"us2"}),D=P.Z.getState(),O=null===(t=D.auth.user)||void 0===t?void 0:null===(i=t.data)||void 0===i?void 0:i.id,J=q.subscribe("user_"+O),L=e=>(console.log("object",e),q.subscribe(e));var V=s(1163),M=!0;function R(){let{query:e}=(0,V.useRouter)(),{user:a}=(0,k.v9)(e=>e.auth),[s,t]=(0,c.useState)({}),{mutate:i,isLoading:d,data:u}=(0,x.uV)({queryFn:g,alert:!1});return(0,c.useEffect)(()=>{(null==e?void 0:e.id)&&i({user_id:null==e?void 0:e.id},{onSuccess:e=>{t(e.data)}})},[null==e?void 0:e.id]),console.log(s),(0,c.useEffect)(()=>{Object.keys(s).length&&s.chat_id&&(console.log(s.chat_id),console.log("enter",s.chat_id),L(s.chat_id).bind("send-message-event",e=>{console.log("chat",e)}))},[s]),(0,c.useEffect)(()=>{J.bind("new-chat-event",e=>{})},[]),(0,n.jsx)("section",{className:"chat-page-container",children:(0,n.jsx)(l.Z,{children:(0,n.jsxs)(o.Z,{className:"g-4",children:[(0,n.jsx)(r.Z,{lg:{order:"first",span:7},xs:{order:"last"},children:(0,n.jsx)(j,{user:a,currentConversationData:s})}),(0,n.jsx)(r.Z,{lg:5,children:(0,n.jsx)(Z,{user:a,setCurrentConversationData:t})})]})})})}R.getLayout=function(e){return(0,n.jsx)(F.Z,{containerProps:E.n.containerProps,headerProps:E.n.headerProps,children:e})}}},function(e){e.O(0,[296,307,438,907,186,251,665,774,888,179],function(){return e(e.s=813)}),_N_E=e.O()}]);